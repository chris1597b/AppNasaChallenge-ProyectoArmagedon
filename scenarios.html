<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asteroid Impact Simulator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <link rel="stylesheet" href="scenario.css">
    
</head>

<body>
    <nav class="navbar">
        <div class="logo">
            <i class="fas fa-globe-americas"></i>
            <h2 id="title">Project Armageddon</h2>
        </div>
        <div class="nav-links">
            <a href="index.html" class="active">Home</a>
            <a href="scenarios.html">Scenarios & Defense</a>
            <a href="mineria.html">Mining</a>
            <a href="Educativo.html">Education</a>
        </div>
    </nav>
    <div class="container">
        <h1>üå† ASTEROID IMPACT SIMULATOR üå†</h1>
        <p class="subtitle">Experience the devastation of a cosmic impact in real time</p>

        <div class="grid">
            <div class="left-panel">
                <div class="card">
                    <h2>‚öôÔ∏è Configuration</h2>
                    <!--Seleccion de Asteroides-->
                    <div class="parameter-group">
                        <label for="asteroid-select">SELECT ASTEROIDS</label>
                        <select id="asteroid-select">
                            <option value="">Loading asteroids...</option>
                        </select>

                    </div>
                    <div class="slider-group">
                        <label>TYPE OF ASTEROID</label>
                        <div class="asteroid-types">
                            <button class="asteroid-btn active" data-type="iron">
                                <span class="emoji">ü™®</span>
                                Iron
                            </button>
                            <button class="asteroid-btn" data-type="stone">
                                <span class="emoji">üåë</span>
                                Stone
                            </button>
                            <button class="asteroid-btn" data-type="carbon">
                                <span class="emoji">‚ö´</span>
                                Carbon
                            </button>
                            <button class="asteroid-btn" data-type="ice">
                                <span class="emoji">‚ùÑÔ∏è</span>
                                Ice
                            </button>
                        </div>
                    </div>
                    <div class="slider-group">
                        <main class="simulator-container">
                            <section class="parameters-section">
                                <!--Diametro maximo y minimo-->
                                <div class="parameter-group">
                                    <label for="diameter">Estimated Diameter (m)</label>
                                    <ul id="asteroid-diameter">
                                    </ul>
                                    <input type="range" id="diameter" step="0.01">
                                    <span class="parameter-value"><span>
                                </div>
                                <div class="parameter-group">
                                    <label for="velocity">Relative Speed ‚Äã‚Äã(km/s)</label>
                                    <ul id="asteroid-velocity"></ul>
                                    <input type="range" id="velocity" step="0.001">
                                    <span class="parameter-value"></span>
                                </div>
                                <div class="slider-group">
                                    <label>Angle of impact <span id="angle-value">45</span> <span>degrees</span></label>
                                    <input type="range" id="angle" min="0" max="90" value="45">
                                    <div class="slider-labels">
                                        <span>0¬∞ (rasante)</span>
                                        <span>90¬∞ (vertical)</span>
                                    </div>
                                </div>
                            </section>

                        </main>
                    </div>



                    <button class="launch-btn disabled" id="launch-btn">
                        üìç Select location
                    </button>
                </div>
            </div>

            <div class="right-panel">
                <div class="card">
                    <h2>üó∫Ô∏è INTERACTIVE MAP - CLICK TO SELECT LOCATION</h2>
                    <div id="map"></div>
                    <div id="location-status" class="location-status hidden"></div>
                    <div class="api-info">
                        üåç <strong>Mapa:</strong> OpenStreetMap (Libre) | üì° <strong>API:</strong> Leaflet.js (Open
                        Source)
                    </div>
                </div>

                <div class="card hidden" id="results-card">
                    <h2
                        style="text-align: center; background: linear-gradient(90deg, #dc2626, #ea580c); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                        üî• IMPACT RESULTS üî•
                    </h2>

                    <div class="effects-nav" id="effects-nav"></div>
                    <div id="effect-display"></div>

                    <button class="reset-btn" id="reset-btn">
                        üîÑ LAUNCH ANOTHER ASTEROID
                    </button>
                </div>

                <div class="card hidden" id="defense-card">
                    <h2
                        style="text-align: center; background: linear-gradient(90deg, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                        üõ°Ô∏è PLANETARY DEFENSE STRATEGIES üõ°Ô∏è
                    </h2>
                    <p style="text-align: center; color: #94a3b8; margin-bottom: 20px;">The Arsenal of the Earth</p>

                    <div class="defense-grid">
                        <div class="defense-card" data-defense="kinetic">
                            <div class="defense-header">
                                <div class="defense-icon">üöÄ</div>
                                <div class="defense-title">
                                    <h3>Kinetic Impactor</h3>
                                    <p>Ntns./grro link</p>
                                </div>
                            </div>
                            <div class="defense-description">
                                How It Works: High-speed collision to transfer momentum.
                            </div>
                            <div class="defense-controls">
                                <div class="control-item">
                                    <label>Impactor Mass: <span class="value">500</span> kg</label>
                                    <input type="range" class="defense-slider" data-param="kineticMass" min="100"
                                        max="2000" value="500">
                                </div>
                                <div class="control-item">
                                    <label>Intervention Time:<span class="value">10</span> years</label>
                                    <input type="range" class="defense-slider" data-param="kineticTime" min="5" max="20"
                                        value="10">
                                </div>
                            </div>
                            <div class="defense-stats">
                                <div class="stat-badge success">‚úì Tested (DART Mission)</div>
                                <div class="stat-badge danger">‚úó Risk of Fragmentation</div>
                                <div class="stat-badge">‚è±Ô∏è 5-20 years</div>
                            </div>
                        </div>

                        <div class="defense-card" data-defense="gravitational">
                            <div class="defense-header">
                                <div class="defense-icon">üõ∏</div>
                                <div class="defense-title">
                                    <h3>Gravitational Tractor</h3>
                                    <p>Nina's Enancte./grro</p>
                                </div>
                            </div>
                            <div class="defense-description">
                                How It Works: The ship's gravity slowly deflects the asteroid.
                            </div>
                            <div class="defense-controls">
                                <div class="control-item">
                                    <label>Ship Mass: <span class="value">20000</span> kg</label>
                                    <input type="range" class="defense-slider" data-param="gravMass" min="5000"
                                        max="50000" value="20000" step="1000">
                                </div>
                                <div class="control-item">
                                    <label>Duration of Operation: <span class="value">15</span> years</label>
                                    <input type="range" class="defense-slider" data-param="gravDuration" min="10"
                                        max="25" value="15">
                                </div>
                            </div>
                            <div class="defense-stats">
                                <div class="stat-badge success">‚úì Ship Mass</div>
                                <div class="stat-badge success">‚úì Mystique of "Flight"</div>
                                <div class="stat-badge warning">‚úó Extremely Slow</div>
                                <div class="stat-badge">‚è±Ô∏è 20-25 years</div>
                            </div>
                        </div>

                        <div class="defense-card" data-defense="laser">
                            <div class="defense-header">
                                <div class="defense-icon">üî¥</div>
                                <div class="defense-title">
                                    <h3>Ablation Laser</h3>
                                    <p>(Distanced)</p>
                                </div>
                            </div>
                            <div class="defense-description">
                                How It Works: Laser beam vaporizes surface creating a 'rocket'.
                            </div>
                            <div class="defense-controls">
                                <div class="control-item">
                                    <label>Laser Power: <span class="value">5</span> MW</label>
                                    <input type="range" class="defense-slider" data-param="laserPower" min="1" max="10"
                                        value="5">
                                </div>
                                <div class="control-item">
                                    <label>"Flight" Distance: <span class="value">15</span> years</label>
                                    <input type="range" class="defense-slider" data-param="laserDistance" min="10"
                                        max="20" value="15">
                                </div>
                                <div class="control-item">
                                    <label>Mission Duration:<span class="value">3</span> years</label>
                                    <input type="range" class="defense-slider" data-param="laserDuration" min="1"
                                        max="5" value="3">
                                </div>
                            </div>
                            <div class="defense-stats">
                                <div class="stat-badge success">‚úì Laser Adjustment</div>
                                <div class="stat-badge warning">‚úó No Contact</div>
                                <div class="stat-badge warning">‚úó Experimental Technology</div>
                                <div class="stat-badge">‚è±Ô∏è 10-20 years</div>
                            </div>
                        </div>

                        <div class="defense-card" data-defense="nuclear">
                            <div class="defense-header">
                                <div class="defense-icon">üí•</div>
                                <div class="defense-title">
                                    <h3>Nuclear Explosion</h3>
                                    <p>(Distanced)</p>
                                </div>
                            </div>
                            <div class="defense-description">
                                How It Works: Nearby detonation pushes asteroid creating radiation.
                            </div>
                            <div class="defense-controls">
                                <div class="control-item">
                                    <label>Device Power: <span class="value">1000</span>kilotons</label>
                                    <input type="range" class="defense-slider" data-param="nuclearPower" min="100"
                                        max="5000" value="1000" step="100">
                                </div>
                                <div class="control-item">
                                    <label>Missile Technology: <span class="value">3</span> years</label>
                                    <input type="range" class="defense-slider" data-param="nuclearTech" min="1" max="5"
                                        value="3">
                                </div>
                                <div class="control-item">
                                    <label>Detonation Distance: <span class="value">500</span> meters</label>
                                    <input type="range" class="defense-slider" data-param="nuclearDistance" min="100"
                                        max="1000" value="500" step="50">
                                </div>
                            </div>
                            <div class="defense-stats">
                                <div class="stat-badge success">‚úì Immense Power</div>
                                <div class="stat-badge danger">‚úó High Risk, Controversial</div>
                                <div class="stat-badge danger">‚úó Difficult Controversial</div>
                                <div class="stat-badge">‚è±Ô∏è < 5 years</div>
                                </div>
                            </div>
                        </div>

                        <button class="simulate-defense-btn" id="simulate-defense-btn" disabled>
                            üõ°Ô∏è RUN DEFENSE SIMULATION
                        </button>

                        <div id="simulation-result" class="simulation-result hidden"></div>

                        <div class="api-info" style="margin-top: 15px;">
                            üî¨ <strong>Calculations:</strong> Impact physics based on scientific models | üöÄ
                            <strong>Defense Data:</strong> NASA & ESA
                        </div>
                    </div>
                </div>
            </div>

            <div class="footer">
                <p>‚ö†Ô∏è This simulator uses free and open source APIs:</p>
                <p>üó∫Ô∏è <strong>Leaflet.js</strong> (Open Source) + <strong>OpenStreetMap</strong> (Free data from the community)</p>
                <p>üìä Calculations are based on the kinetic energy, mass, velocity and composition of the asteroid.</p>
                <p>üîì 100% vanilla JavaScript code - No commercial dependencies</p>
            </div>
        </div>

        <script src="scenarios.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
        <script>
            const asteroidTypes = {
                iron: { name: 'Hierro', density: 7800, emoji: 'ü™®' },
                stone: { name: 'Piedra', density: 3000, emoji: 'üåë' },
                carbon: { name: 'Carbono', density: 2000, emoji: '‚ö´' },
                ice: { name: 'Hielo', density: 1000, emoji: '‚ùÑÔ∏è' }
            };

            const state = {
                type: 'iron',
                diameter: 500,
                velocity: 17,
                angle: 45,
                impactLocation: null,
                results: null,
                currentEffect: 0,
                selectedDefense: null,
                defenseParams: {
                    kineticMass: 500,
                    kineticTime: 10,
                    gravMass: 20000,
                    gravDuration: 15,
                    laserPower: 5,
                    laserDistance: 15,
                    laserDuration: 3,
                    nuclearPower: 1000,
                    nuclearTech: 3,
                    nuclearDistance: 500
                }
            };

            let map, marker, circles = [];

            // Inicializar mapa con OpenStreetMap (API libre)
            function initMap() {
                map = L.map('map').setView([20, 0], 2);

                // OpenStreetMap - Completamente gratuito y de c√≥digo abierto
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    maxZoom: 19
                }).addTo(map);

                map.on('click', handleMapClick);
            }

            function handleMapClick(e) {
                state.impactLocation = { lat: e.latlng.lat, lng: e.latlng.lng };

                if (marker) {
                    map.removeLayer(marker);
                }
                circles.forEach(circle => map.removeLayer(circle));
                circles = [];

                const redIcon = L.divIcon({
                    className: 'custom-marker',
                    html: '<div style="background: red; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 10px rgba(255,0,0,0.8);"></div>',
                    iconSize: [20, 20],
                    iconAnchor: [10, 10]
                });

                marker = L.marker([e.latlng.lat, e.latlng.lng], { icon: redIcon }).addTo(map);

                for (let i = 1; i <= 3; i++) {
                    const circle = L.circle([e.latlng.lat, e.latlng.lng], {
                        color: 'red',
                        fillColor: 'red',
                        fillOpacity: 0.1 * (4 - i),
                        radius: 50000 * i,
                        weight: 2
                    }).addTo(map);
                    circles.push(circle);
                }

                document.getElementById('location-status').classList.remove('hidden');
                document.getElementById('location-status').textContent =
                    `‚úì Ubicaci√≥n seleccionada: ${e.latlng.lat.toFixed(4)}, ${e.latlng.lng.toFixed(4)}`;

                document.getElementById('launch-btn').classList.remove('disabled');
                document.getElementById('launch-btn').classList.add('active');
                document.getElementById('launch-btn').textContent = 'üöÄ LAUNCH ASTEROID';

                document.getElementById('results-card').classList.add('hidden');
                document.getElementById('defense-card').classList.add('hidden');
            }

            function calculateImpact() {
                if (!state.impactLocation) {
                    alert('Please select an impact location on the map');
                    return;
                }

                const currentType = asteroidTypes[state.type];
                const radius = state.diameter / 2;
                const volume = (4 / 3) * Math.PI * Math.pow(radius, 3);
                const mass = volume * currentType.density;

                const velocityMs = state.velocity * 1000;
                const kineticEnergy = 0.5 * mass * Math.pow(velocityMs, 2);
                const megatonsTNT = kineticEnergy / (4.184e15);

                const craterDiameter = state.diameter * Math.pow(kineticEnergy / 1e15, 0.25) * 0.15;
                const craterDepth = craterDiameter * 0.3;
                const fireballRadius = Math.pow(megatonsTNT, 0.4) * 15;
                const shockwaveRadius = Math.pow(megatonsTNT, 0.33) * 50;
                const windSpeed = Math.min(4000, Math.sqrt(kineticEnergy / 1e18) * 100);
                const windRadius = Math.pow(megatonsTNT, 0.4) * 30;
                const magnitude = Math.min(9.5, 3 + Math.log10(megatonsTNT) * 0.67);
                const seismicRadius = Math.pow(10, magnitude) * 10;

                const impactFrequency = Math.pow(state.diameter / 1000, 2.5) * 1000000;

                state.results = {
                    energy: megatonsTNT,
                    crater: {
                        diameter: craterDiameter,
                        depth: craterDepth,
                        deaths: Math.floor(craterDiameter * craterDiameter * 100)
                    },
                    fireball: {
                        radius: fireballRadius,
                        deaths: Math.floor(fireballRadius * fireballRadius * 50),
                        burns1st: Math.floor(fireballRadius * fireballRadius * 75),
                        burns2nd: Math.floor(fireballRadius * fireballRadius * 100),
                        ignitionClothes: fireballRadius * 1.2,
                        ignitionTrees: fireballRadius * 1.5
                    },
                    shockwave: {
                        radius: shockwaveRadius,
                        overpressure: 241,
                        deaths: Math.floor(shockwaveRadius * shockwaveRadius * 20),
                        lungDamage: shockwaveRadius * 0.3,
                        eardrumRupture: shockwaveRadius * 0.5,
                        buildingCollapse: shockwaveRadius * 0.7,
                        homeCollapse: shockwaveRadius * 0.9
                    },
                    wind: {
                        speed: windSpeed,
                        radius: windRadius,
                        deaths: Math.floor(windRadius * windRadius * 15),
                        treesDown: windRadius * 0.9,
                        homesLeveled: windRadius * 0.6
                    },
                    seismic: {
                        magnitude: magnitude,
                        radius: seismicRadius,
                        deaths: Math.floor(seismicRadius * 10),
                        feltDistance: seismicRadius * 2
                    },
                    frequency: impactFrequency
                };

                displayResults();
            }

            function displayResults() {
                circles.forEach(circle => map.removeLayer(circle));
                circles = [];

                const effects = [
                    { radius: state.results.crater.diameter, color: '#8B4513', label: 'Crater' },
                    { radius: state.results.fireball.radius, color: '#FF4500', label: 'Fireball' },
                    { radius: state.results.shockwave.radius, color: '#4169E1', label: 'Shock wave' },
                    { radius: state.results.wind.radius, color: '#DC143C', label: 'Winds' },
                    { radius: state.results.seismic.radius, color: '#FF8C00', label: 'Earthquake' }
                ];

                effects.forEach(effect => {
                    const circle = L.circle([state.impactLocation.lat, state.impactLocation.lng], {
                        color: effect.color,
                        fillColor: effect.color,
                        fillOpacity: 0.15,
                        radius: effect.radius * 1000,
                        weight: 2
                    }).addTo(map);

                    circle.bindPopup(`${effect.label}: ${effect.radius.toFixed(1)} km`);
                    circles.push(circle);
                });

                map.fitBounds(circles[circles.length - 1].getBounds());

                const effectsData = [
                    {
                        title: `${state.results.crater.diameter.toFixed(0)} KM IN DIAMETER`,
                        subtitle: 'CRATER',
                        icon: '‚õ∞Ô∏è',
                        color: 'linear-gradient(135deg, #92400e, #b45309)',
                        stats: [
                            `üíÄ ${state.results.crater.deaths.toLocaleString()} people vaporized in the crater`,
                            `‚õ∞Ô∏è The crater has ${state.results.crater.depth.toFixed(0)} meters deep`,
                            `‚ö° Your asteroid hit the ground a ${state.velocity} km/s`,
                            `‚ö†Ô∏è Energy is equivalent to ${state.results.energy.toFixed(1)} megatons of TNT`,
                            `üìª An impact like this happens every ${state.results.frequency.toLocaleString()} years`
                        ]
                    },
                    {
                        title: `${state.results.fireball.radius.toFixed(0)} KM IN DIAMETER`,
                        subtitle: 'FIREBALL',
                        icon: 'üî•',
                        color: 'linear-gradient(135deg, #ca8a04, #ea580c)',
                        stats: [
                            `üíÄ ${state.results.fireball.deaths.toLocaleString()} people would die from the fireball`,
                            `üî• ${state.results.fireball.burns1st.toLocaleString()} people would receive first-degree burns`,
                            `üî• ${state.results.fireball.burns2nd.toLocaleString()} people would receive second-degree burns`,
                            `üî• The clothes would catch fire inside ${state.results.fireball.ignitionClothes.toFixed(0)} km`,
                            `üî• The trees would burn inside ${state.results.fireball.ignitionTrees.toFixed(0)} km`
                        ]
                    },
                    {
                        title: `${state.results.shockwave.overpressure} Decibels`,
                        subtitle: 'SHOCK WAVE',
                        icon: 'üìª',
                        color: 'linear-gradient(135deg, #2563eb, #1e40af)',
                        stats: [
                            `üíÄ ${state.results.shockwave.deaths.toLocaleString()} people would die from the shock wave`,
                            `‚ö†Ô∏è Anyone within ${state.results.shockwave.lungDamage.toFixed(0)} km would receive lung damage`,
                            `üìª Anyone within ${state.results.shockwave.eardrumRupture.toFixed(0)} km would have ruptured eardrums`,
                            `üè† Buildings within  ${state.results.shockwave.buildingCollapse.toFixed(0)} km would collapse`,
                            `üè† Houses within ${state.results.shockwave.homeCollapse.toFixed(0)} km would collapse`
                        ]
                    },
                    {
                        title: `${state.results.wind.speed.toFixed(1)} M/S PEAK SPEED`,
                        subtitle: 'WINDS',
                        icon: 'üí®',
                        color: 'linear-gradient(135deg, #dc2626, #b91c1c)',
                        stats: [
                            `üíÄ ${state.results.wind.deaths.toLocaleString()} people would die from the wind`,
                            `üí® The winds would be ${(state.results.wind.speed / 340).toFixed(1)}x faster than Jupiter's storms`,
                            `üè† Houses within ${state.results.wind.homesLeveled.toFixed(0)} km would be razed`,
                            `‚õ∞Ô∏è Within ${state.results.wind.treesDown.toFixed(0)} km It would feel like being inside an EF5 tornado.`,
                            `‚ö†Ô∏è Almost all the trees within ${state.results.wind.treesDown.toFixed(0)} km would be demolished`
                        ]
                    },
                    {
                        title: `MAGNITUDE ${state.results.seismic.magnitude.toFixed(1)}`,
                        subtitle: 'EARTHQUAKE',
                        icon: 'üåã',
                        color: 'linear-gradient(135deg, #ea580c, #dc2626)',
                        stats: [
                            `üíÄ ${state.results.seismic.deaths.toLocaleString()} people would die from the earthquake`,
                            `üìª The earthquake would be felt at ${state.results.seismic.feltDistance.toFixed(0)} km away`,
                            `‚õ∞Ô∏è An earthquake of this magnitude occurs approximately every${(state.results.frequency / 100).toFixed(0)} years`,
                            `‚ö†Ô∏è The shock would cause massive structural damage in a wide radius.`
                        ]
                    }
                ];

                const nav = document.getElementById('effects-nav');
                nav.innerHTML = '';
                effectsData.forEach((effect, idx) => {
                    const btn = document.createElement('button');
                    btn.className = 'effect-btn' + (idx === 0 ? ' active' : '');
                    btn.style.background = idx === 0 ? effect.color : '';
                    btn.innerHTML = `<span>${effect.icon}</span> ${effect.subtitle}`;
                    btn.onclick = () => showEffect(idx, effectsData);
                    nav.appendChild(btn);
                });

                showEffect(0, effectsData);
                document.getElementById('results-card').classList.remove('hidden');

                // Mostrar secci√≥n de defensa
                document.getElementById('defense-card').classList.remove('hidden');
                document.getElementById('simulation-result').classList.add('hidden');
            }

            function showEffect(idx, effectsData) {
                state.currentEffect = idx;
                const effect = effectsData[idx];

                document.querySelectorAll('.effect-btn').forEach((btn, i) => {
                    if (i === idx) {
                        btn.classList.add('active');
                        btn.style.background = effect.color;
                    } else {
                        btn.classList.remove('active');
                        btn.style.background = 'rgba(255, 255, 255, 0.1)';
                    }
                });

                const display = document.getElementById('effect-display');
                display.innerHTML = `
                <div class="effect-card" style="background: ${effect.color}">
                    <div class="effect-header">
                        <div class="effect-icon">${effect.icon}</div>
                        <div class="effect-title">${effect.title}</div>
                        <div class="effect-subtitle">${effect.subtitle}</div>
                    </div>
                    <div class="stats-container">
                        ${effect.stats.map(stat => `
                            <div class="stat-item">
                                <div class="stat-icon">${stat.substring(0, 2)}</div>
                                <div>${stat.substring(3)}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            }

            // Event listeners
            document.querySelectorAll('.asteroid-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.asteroid-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    state.type = btn.dataset.type;
                });
            });

            document.getElementById('diameter').addEventListener('input', (e) => {
                state.diameter = parseInt(e.target.value);
                document.getElementById('diameter-value').textContent = state.diameter;
            });

            document.getElementById('velocity').addEventListener('input', (e) => {
                state.velocity = parseInt(e.target.value);
                document.getElementById('velocity-value').textContent = state.velocity;
            });

            document.getElementById('angle').addEventListener('input', (e) => {
                state.angle = parseInt(e.target.value);
                document.getElementById('angle-value').textContent = state.angle;
            });

            document.getElementById('launch-btn').addEventListener('click', calculateImpact);

            document.getElementById('reset-btn').addEventListener('click', () => {
                state.impactLocation = null;
                state.results = null;
                state.selectedDefense = null;
                if (marker) {
                    map.removeLayer(marker);
                    marker = null;
                }
                circles.forEach(circle => map.removeLayer(circle));
                circles = [];

                document.getElementById('results-card').classList.add('hidden');
                document.getElementById('defense-card').classList.add('hidden');
                document.getElementById('location-status').classList.add('hidden');
                document.getElementById('launch-btn').classList.remove('active');
                document.getElementById('launch-btn').classList.add('disabled');
                document.getElementById('launch-btn').textContent = 'üìç Select location';

                document.querySelectorAll('.defense-card').forEach(card => {
                    card.classList.remove('selected');
                });
            });

            // Defense system handlers
            document.querySelectorAll('.defense-card').forEach(card => {
                card.addEventListener('click', function () {
                    document.querySelectorAll('.defense-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    state.selectedDefense = this.dataset.defense;
                    document.getElementById('simulate-defense-btn').disabled = false;
                    document.getElementById('simulation-result').classList.add('hidden');
                });
            });

            document.querySelectorAll('.defense-slider').forEach(slider => {
                slider.addEventListener('input', function () {
                    const param = this.dataset.param;
                    const value = parseInt(this.value);
                    state.defenseParams[param] = value;

                    const label = this.parentElement.querySelector('.value');
                    label.textContent = value.toLocaleString();
                });
            });

            document.getElementById('simulate-defense-btn').addEventListener('click', () => {
                if (!state.selectedDefense || !state.results) return;

                const defenseType = state.selectedDefense;
                const asteroid = state.results;
                const params = state.defenseParams;

                let success = false;
                let resultText = '';
                let details = [];

                // Calcular probabilidad de √©xito basada en par√°metros
                const asteroidThreat = asteroid.energy;
                const detectionTime = 10;

                switch (defenseType) {
                    case 'kinetic':
                        const kineticEfficiency = (params.kineticMass / 500) * (params.kineticTime / 10);
                        const kineticThreshold = asteroidThreat / 100;
                        success = kineticEfficiency > kineticThreshold && params.kineticTime >= 5;

                        if (success) {
                            resultText = 'MISSION SUCCESSFUL! The kinetic impactor has successfully deflected the asteroid.';
                            details = [
                                `‚úì The impact transferred ${(params.kineticMass * 17).toLocaleString()} kg¬∑km/s for now`,
                                `‚úì The asteroid's trajectory has now deviated ${(0.01 * kineticEfficiency).toFixed(4)}¬∞ from its original course`,
                                `‚úì The asteroid will pass by ${(30000 * kineticEfficiency).toFixed(0)} km from Earth`,
                                `‚úì Preparation time used: ${params.kineticTime} years`,
                                `‚úì Minimal fragmentation detected - threat neutralized`
                            ];
                        } else {
                            resultText = '‚ùå MISSION FAILED. The impactor did not generate sufficient deflection.';
                            details = [
                                `‚úó Insufficient transferred moment: ${(params.kineticMass * 17).toLocaleString()} kg¬∑km/s`,
                                `‚úó Deviation achieved: only ${(0.005 * kineticEfficiency).toFixed(4)}¬∞`,
                                `‚úó The asteroid will impact in ${detectionTime - params.kineticTime} years`,
                                `‚ö†Ô∏è Greater impactor mass or longer intervention time is required`,
                                `‚ö†Ô∏è Risk of dangerous asteroid fragmentation`
                            ];
                        }
                        break;

                    case 'gravitational':
                        const gravEfficiency = (params.gravMass / 20000) * (params.gravDuration / 15);
                        const gravThreshold = asteroidThreat / 50;
                        success = gravEfficiency > gravThreshold && params.gravDuration >= 15;

                        if (success) {
                            resultText = 'MISSION SUCCESSFUL! The gravitational tractor has modified the asteroid is orbit.';
                            details = [
                                `‚úì Continuous operation during ${params.gravDuration} years`,
                                `‚úì Accumulated gravitational force: ${(params.gravMass * 0.0001).toFixed(6)} N`,
                                `‚úì Total orbital deviation: ${(0.02 * gravEfficiency).toFixed(5)}¬∞`,
                                `‚úì Safe walking distance: ${(50000 * gravEfficiency).toFixed(0)} km`,
                                `‚úì Safer method - zero risk of fragmentation`
                            ];
                        } else {
                            resultText = '‚ùå MISSION FAILED. Insufficient time for effective fun.';
                            details = [
                                `‚úó Insufficient mission duration: ${params.gravDuration} years`,
                                `‚úó Inadequate ship mass: ${params.gravMass.toLocaleString()} kg`,
                                `‚úó Deviation achieved: only ${(0.008 * gravEfficiency).toFixed(5)}¬∞`,
                                `‚ö†Ô∏è At least are required ${Math.ceil(gravThreshold * 15)} years of operation`,
                                `‚ö†Ô∏è This method works best with small asteroids.`
                            ];
                        }
                        break;

                    case 'laser':
                        const laserEfficiency = (params.laserPower / 5) * (params.laserDuration / 3) * (params.laserDistance / 15);
                        const laserThreshold = asteroidThreat / 80;
                        success = laserEfficiency > laserThreshold && params.laserDistance >= 12;

                        if (success) {
                            resultText = 'MISSION SUCCESSFUL! The ablation laser has created an effective rocket effect.';
                            details = [
                                `‚úì Laser power: ${params.laserPower} MW during ${params.laserDuration} years`,
                                `‚úì Vaporized material: ${(params.laserPower * params.laserDuration * 1000).toLocaleString()} kg`,
                                `‚úì Thrust generated: ${(params.laserPower * 0.5).toFixed(2)} N continuous`,
                                `‚úì Cumulative deviation: ${(0.015 * laserEfficiency).toFixed(4)}¬∞`,
                                `‚úì Precise trajectory control - without fragmentation`
                            ];
                        } else {
                            resultText = '‚ùå MISSION FAILED. Laser ablation was insufficient.';
                            details = [
                                `‚úó Inadequate laser power:${params.laserPower} MW`,
                                `‚úó Very short application time:${params.laserDuration} years`,
                                `‚úó Vaporized material: only ${(params.laserPower * params.laserDuration * 1000).toLocaleString()} kg`,
                                `‚ö†Ô∏è Greater power or mission duration is required`,
                                `‚ö†Ô∏è Technology still experimental - high technical risk`
                            ];
                        }
                        break;

                    case 'nuclear':
                        const nuclearEfficiency = (params.nuclearPower / 1000) * (5 - params.nuclearTech);
                        const nuclearThreshold = asteroidThreat / 200;
                        success = nuclearEfficiency > nuclearThreshold && params.nuclearDistance <= 600 && params.nuclearTech <= 3;

                        if (success) {
                            resultText = 'MISSION SUCCESSFUL! The nuclear detonation has deflected the critical asteroid.';
                            details = [
                                `‚úì Detonation of ${params.nuclearPower.toLocaleString()} kilotons a ${params.nuclearDistance}m`,
                                `‚úì Radiant energy transferred: ${(params.nuclearPower * 0.3).toFixed(0)} kilotons`,
                                `‚úì Momentum generated: ${(nuclearEfficiency * 10000).toFixed(0)} N¬∑s`,
                                `‚úì Immediate diversion: ${(0.05 * nuclearEfficiency).toFixed(3)}¬∞`,
                                `‚úì Method of last resort - THREAT NEUTRALIZED`
                            ];
                        } else {
                            resultText = '‚ùå MISSION FAILED. The detonation caused dangerous fragmentation.';
                            details = [
                                `‚úó Detonation too powerful or close`,
                                `‚úó Asteroid fragmented into${Math.floor(Math.random() * 50 + 20)} parts`,
                                `‚úó Multiple fragments continue on a collision course`,
                                `‚ö†Ô∏è Fragmentation worsened the original threat`,
                                `‚ö†Ô∏è They are detected ${Math.floor(Math.random() * 10 + 5)} dangerous fragments`
                            ];
                        }
                        break;
                }

                const resultDiv = document.getElementById('simulation-result');
                resultDiv.className = 'simulation-result ' + (success ? 'success' : 'failure');
                resultDiv.innerHTML = `
                <h3>${success ? '‚úÖ' : '‚ùå'} SIMULATION RESULT</h3>
                <p style="font-size: 1.1rem; margin-bottom: 15px;"><strong>${resultText}</strong></p>
                <ul>
                    ${details.map(detail => `<li>${detail}</li>`).join('')}
                </ul>
                <div class="time-badge">
                    ‚è±Ô∏è Total mission time: ${params[defenseType + 'Time'] || params[defenseType + 'Duration'] || params[defenseType + 'Tech']} years
                </div>
                <div style="margin-top: 15px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                    <strong>üìä Asteroid Analysis:</strong><br>
                    ‚Ä¢ Impact energy: ${asteroid.energy.toFixed(1)} megatons:<br>
                    ‚Ä¢ Diameter: ${state.diameter} metros<br>
                    ‚Ä¢ Speed: ${state.velocity} km/s<br>
                    ‚Ä¢ Composition: ${asteroidTypes[state.type].name}
                </div>
            `;
                resultDiv.classList.remove('hidden');
            });

            // Inicializar
            initMap();

            // Inicializar valores de los sliders de defensa
            document.querySelectorAll('.defense-slider').forEach(slider => {
                const label = slider.parentElement.querySelector('.value');
                label.textContent = slider.value;
            });
        </script>
</body>

</html>